import { getParam, getParamOrExit } from './env-helpers';

export const REDIS_HOST = getParamOrExit('REDIS_HOST');

export const RPC_URL = getParamOrExit('RPC_URL');
const _BACKUP_RPC_URLS: string | null = getParam('BACKUP_RPC_URLS');
const _parseBackupRpcUrls = (value: string) => {
  if (value.length < 1) {
    return [];
  }
  return value.split(',');
};
export const BACKUP_RPC_URLS =
  _BACKUP_RPC_URLS === null ? [] : _parseBackupRpcUrls(_BACKUP_RPC_URLS);

export const RPC_MAX_TIMEOUT = 5000;
export const CHAIN_ID_SHIBUYA = 81 as number;
export const CHAIN_ID = Number(process.env.CHAIN_ID || '0');

if (![CHAIN_ID_SHIBUYA].includes(CHAIN_ID)) {
  throw new Error(`ChainId: "${CHAIN_ID}" is not currently supported`);
}

const CONFIGS: {
  [key: number]: {
    PROTOCOL_ADDRESSES_PROVIDER_ADDRESSES: string[];
    PROTOCOLS_WITH_INCENTIVES_ADDRESSES: string[];
    POOL_UI_DATA_PROVIDER_ADDRESS: string;
    UI_INCENTIVE_DATA_PROVIDER_ADDRESS: string;
    GENERAL_RESERVES_DATA_POOLING_INTERVAL: number;
    USERS_DATA_POOLING_INTERVAL: number;
    RESERVE_INCENTIVES_DATA_POOLING_INTERVAL: number;
    USER_INCENTIVES_DATA_POOLING_INTERVAL: number;
    BLOCK_NUMBER_POOLING_INTERVAL: number;
    CHAINLINK_FEED_QUOTE?: string;
    CHAINLINK_FEEDS_REGISTRY?: string;
  };
} = {
  [CHAIN_ID_SHIBUYA]: {
    BLOCK_NUMBER_POOLING_INTERVAL: 5000,
    PROTOCOL_ADDRESSES_PROVIDER_ADDRESSES: ['0x96F4e3254854E3e8d3Ee294245757f832E1495BC'],
    PROTOCOLS_WITH_INCENTIVES_ADDRESSES: ['0x96F4e3254854E3e8d3Ee294245757f832E1495BC'],
    POOL_UI_DATA_PROVIDER_ADDRESS: '0x76b158eF1Abf6AA1C586b0550705F826460D8f39',
    UI_INCENTIVE_DATA_PROVIDER_ADDRESS: '0x04a3fE0Bd89E3d8AdeFAB776C6F03F81838dd784',
    GENERAL_RESERVES_DATA_POOLING_INTERVAL: 1000,
    USERS_DATA_POOLING_INTERVAL: 1000,
    RESERVE_INCENTIVES_DATA_POOLING_INTERVAL: 1000,
    USER_INCENTIVES_DATA_POOLING_INTERVAL: 1000,
  },
};

const _STAKE_CONFIG = {
  STAKE_DATA_PROVIDER: '0xc57450af527d10Fe182521AB39C1AD23c1e1BaDE',
  STK_AAVE_TOKEN_ADDRESS: '0x4da27a545c0c5B758a6BA100e3a049001de870f5',
  STK_ABPT_TOKEN_ADDRESS: '0xa1116930326D21fB917d5A27F1E9943A9595fb47',
  ABPT_TOKEN: '0x41A08648C3766F9F9d85598fF102a08f4ef84F84',
  AAVE_TOKEN_ADDRESS: '0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9',
  STAKE_DATA_POOLING_INTERVAL: 4000,
};

export const CONFIG = CONFIGS[CHAIN_ID];

export const STAKING_CONFIG = CHAIN_ID === 1 ? _STAKE_CONFIG : undefined;

export const RESERVES_LIST_VALIDITY_INTERVAL = 60 * 5 * 1000;
